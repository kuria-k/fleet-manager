<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
  <title>Add Rider — FleetPulse</title>
  <style>
    body { font-family: 'Plus Jakarta Sans', sans-serif; }

    /* Sidebar import placeholder */
    #sidebar-mount { display: contents; }

    /* Animate page sections in */
    .fade-up {
      opacity: 0;
      transform: translateY(16px);
      animation: fadeUp 0.5s ease forwards;
    }
    @keyframes fadeUp {
      to { opacity: 1; transform: translateY(0); }
    }

    /* Row slide in */
    .row-in {
      animation: rowSlide 0.35s ease both;
    }
    @keyframes rowSlide {
      from { opacity: 0; transform: translateX(-12px); }
      to   { opacity: 1; transform: translateX(0); }
    }

    /* Custom select arrow */
    select { background-image: none; }

    /* Scrollbar styling */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #f1f5f9; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 99px; }

    /* Modal overlay */
    #confirm-overlay {
      backdrop-filter: blur(4px);
    }
  </style>
</head>
<body class="bg-slate-50 text-slate-800">

  <!-- ===== SIDEBAR (injected from sidebar.html) ===== -->
  <div id="sidebar-mount"></div>

  <!-- ===== TOP NAV ===== -->
  <header class="fixed top-0 right-0 left-0 sm:left-64 z-30 h-16 bg-white border-b border-slate-100 flex items-center justify-between px-6 shadow-sm">
    <!-- Mobile hamburger -->
    <button id="sidebar-toggle" class="sm:hidden p-2 rounded-lg hover:bg-slate-100 text-slate-500 transition-colors">
      <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/>
      </svg>
    </button>

    <!-- Breadcrumb -->
    <div class="flex items-center gap-2 text-sm">
      <span class="text-slate-400">Fleet Manager</span>
      <span class="text-slate-300">/</span>
      <span class="font-semibold text-slate-700">Add Rider</span>
    </div>

    <!-- Right nav -->
    <div class="flex items-center gap-3">
      <!-- Notification bell -->
      <button class="relative p-2 rounded-lg hover:bg-slate-100 text-slate-400 transition-colors">
        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
        </svg>
        <span class="absolute top-1.5 right-1.5 w-2 h-2 bg-blue-500 rounded-full"></span>
      </button>
      <!-- Sign out -->
      <button id="signout-btn"
        class="flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-red-500 bg-slate-100 hover:bg-red-50 px-4 py-2 rounded-lg transition-all">
        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
        </svg>
        Sign out
      </button>
    </div>
  </header>

  <!-- ===== MAIN CONTENT ===== -->
  <main class="sm:ml-64 pt-16 min-h-screen">
    <div class="p-6 md:p-8 max-w-6xl mx-auto">

      <!-- Page header -->
      <div class="mb-8 fade-up" style="animation-delay:.05s">
        <div class="flex items-center gap-3 mb-1">
          <div class="w-10 h-10 rounded-xl bg-blue-600 flex items-center justify-center shadow-md shadow-blue-500/25">
            <svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
            </svg>
          </div>
          <div>
            <h1 class="text-xl font-bold text-slate-800">Add New Rider</h1>
            <p class="text-sm text-slate-400">Register a rider to your fleet</p>
          </div>
        </div>
      </div>

      <!-- ===== FORM CARD ===== -->
      <div class="bg-white rounded-2xl border border-slate-100 shadow-sm p-6 md:p-8 mb-6 fade-up" style="animation-delay:.1s">
        <h2 class="text-sm font-semibold text-slate-500 uppercase tracking-widest mb-5 flex items-center gap-2">
          <span class="w-5 h-px bg-slate-200"></span>
          Rider Details
          <span class="flex-1 h-px bg-slate-100"></span>
        </h2>

        <form id="add-form" autocomplete="off">
          <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 mb-6">

            <!-- Name -->
            <div class="flex flex-col gap-1.5">
              <label for="name" class="text-xs font-semibold text-slate-500 uppercase tracking-wide">Full Name</label>
              <input type="text" id="name" placeholder="e.g. John Doe"
                class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-2.5 text-sm text-slate-800 placeholder-slate-300 outline-none focus:border-blue-500 focus:ring-3 focus:ring-blue-100 transition-all"/>
            </div>

            <!-- Phone -->
            <div class="flex flex-col gap-1.5">
              <label for="number" class="text-xs font-semibold text-slate-500 uppercase tracking-wide">Phone Number</label>
              <input type="text" id="number" placeholder="+254 700 000 000"
                class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-2.5 text-sm text-slate-800 placeholder-slate-300 outline-none focus:border-blue-500 focus:ring-3 focus:ring-blue-100 transition-all"/>
            </div>

            <!-- Date -->
            <div class="flex flex-col gap-1.5">
              <label for="date" class="text-xs font-semibold text-slate-500 uppercase tracking-wide">Date Added</label>
              <input type="date" id="date"
                class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-2.5 text-sm text-slate-700 outline-none focus:border-blue-500 focus:ring-3 focus:ring-blue-100 transition-all"/>
            </div>

            <!-- Branch -->
            <div class="flex flex-col gap-1.5">
              <label for="category" class="text-xs font-semibold text-slate-500 uppercase tracking-wide">Branch</label>
              <div class="relative">
                <select id="category"
                  class="w-full appearance-none bg-slate-50 border border-slate-200 rounded-xl px-4 py-2.5 text-sm text-slate-700 outline-none focus:border-blue-500 focus:ring-3 focus:ring-blue-100 transition-all cursor-pointer pr-9">
                  <option value="select">— Select Branch —</option>
                  <option value="Agriculture">Agriculture</option>
                  <option value="Westlands">Westlands</option>
                  <option value="Adlife">Adlife</option>
                  <option value="Mombasa">Mombasa</option>
                  <option value="Thika">Thika</option>
                  <option value="Kisumu">Kisumu</option>
                </select>
                <span class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none text-xs">▾</span>
              </div>
            </div>
          </div>

          <!-- Submit -->
          <div class="flex items-center justify-between flex-wrap gap-3">
            <p id="form-error" class="text-sm text-red-500 hidden">⚠ Please fill in all fields correctly.</p>
            <button type="submit"
              class="ml-auto flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold px-6 py-2.5 rounded-xl shadow-md shadow-blue-500/25 hover:shadow-blue-500/40 transition-all active:scale-95">
              <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
              </svg>
              Add Rider
            </button>
          </div>
        </form>
      </div>

      <!-- ===== RIDERS TABLE ===== -->
      <div class="bg-white rounded-2xl border border-slate-100 shadow-sm fade-up" style="animation-delay:.15s">
        

        <!-- Table header -->
        <div class="flex items-center justify-between px-6 py-4 border-b border-slate-100">
          <div>
            <h2 class="font-bold text-slate-800">Registered Riders</h2>
            <p class="text-xs text-slate-400 mt-0.5"><span id="rider-count">0</span> riders in your fleet</p>
          </div>
          <!-- Search -->
          <div class="relative hidden sm:block">
            <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
            </svg>
            <input type="text" id="search-input" placeholder="Search riders…"
              class="pl-9 pr-4 py-2 text-sm bg-slate-50 border border-slate-200 rounded-xl outline-none focus:border-blue-400 focus:ring-2 focus:ring-blue-100 w-56 transition-all"/>
          </div>
        </div>

        <!-- Table -->
        <div class="overflow-x-auto">
          <table class="w-full text-sm">
            <thead>
              <tr class="bg-slate-50 border-b border-slate-100">
                <th class="text-left text-xs font-semibold text-slate-400 uppercase tracking-wider px-6 py-3">#</th>
                <th class="text-left text-xs font-semibold text-slate-400 uppercase tracking-wider px-6 py-3">Rider</th>
                <th class="text-left text-xs font-semibold text-slate-400 uppercase tracking-wider px-6 py-3">Phone</th>
                <th class="text-left text-xs font-semibold text-slate-400 uppercase tracking-wider px-6 py-3">Date Added</th>
                <th class="text-left text-xs font-semibold text-slate-400 uppercase tracking-wider px-6 py-3">Branch</th>
                <th class="text-left text-xs font-semibold text-slate-400 uppercase tracking-wider px-6 py-3">Action</th>
              </tr>
            </thead>
            <tbody id="table-body" class="divide-y divide-slate-50">
            </tbody>
          </table>

          <!-- Empty state -->
          <div id="empty-state" class="flex flex-col items-center justify-center py-16 text-slate-300">
            <svg class="w-12 h-12 mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
              <path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/>
            </svg>
            <p class="text-sm font-medium text-slate-400">No riders added yet</p>
            <p class="text-xs text-slate-300 mt-1">Fill the form above to register your first rider</p>
          </div>
        </div>
      </div>

    </div>
  </main>

  <!-- ===== SIGN-OUT CONFIRM MODAL ===== -->
  <div id="confirm-overlay" class="hidden fixed inset-0 z-50 bg-slate-900/40 flex items-center justify-center">
    <div id="confirm-modal" class="bg-white rounded-2xl shadow-2xl p-7 w-80 text-center transform transition-all scale-95 opacity-0">
      <div class="w-12 h-12 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-4">
        <svg class="w-6 h-6 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
        </svg>
      </div>
      <h3 class="font-bold text-slate-800 mb-1">Sign out?</h3>
      <p class="text-sm text-slate-400 mb-6">You'll be redirected to the login page.</p>
      <div class="flex gap-3">
        <button id="noBtn" class="flex-1 py-2.5 rounded-xl border border-slate-200 text-slate-600 text-sm font-medium hover:bg-slate-50 transition-colors">Cancel</button>
        <a href="login.html" id="yesBtn" class="flex-1 py-2.5 rounded-xl bg-red-500 text-white text-sm font-semibold hover:bg-red-600 transition-colors">Sign out</a>
      </div>
    </div>
  </div>

  <!-- ===== TOAST ===== -->
  <div id="toast" class="fixed bottom-6 right-6 z-50 flex items-center gap-3 bg-slate-800 text-white text-sm font-medium px-5 py-3 rounded-xl shadow-xl translate-y-16 opacity-0 transition-all duration-300">
    <svg class="w-4 h-4 text-green-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
      <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/>
    </svg>
    <span id="toast-msg">Rider added successfully!</span>
  </div>

  <script>
    // ============================================================
    // SIDEBAR IMPORT
    // ============================================================
    fetch('sidebar.html')
      .then(r => r.text())
      .then(html => {
        document.getElementById('sidebar-mount').innerHTML = html;

        // Mobile toggle after sidebar loads
        document.getElementById('sidebar-toggle').addEventListener('click', () => {
          const sb = document.getElementById('sidebar');
          if (sb) sb.classList.toggle('-translate-x-full');
        });
      })
      .catch(() => {
        // Graceful fail: sidebar not found (e.g. opened as local file)
        console.warn('sidebar.html not found — run via a local server.');
      });

    // ============================================================
    // DOM REFS
    // ============================================================
    const form          = document.getElementById('add-form');
    const nameInput     = document.getElementById('name');
    const numberInput   = document.getElementById('number');
    const dateInput     = document.getElementById('date');
    const categoryInput = document.getElementById('category');
    const tableBody     = document.getElementById('table-body');
    const emptyState    = document.getElementById('empty-state');
    const riderCount    = document.getElementById('rider-count');
    const formError     = document.getElementById('form-error');
    const searchInput   = document.getElementById('search-input');

    // Modal
    const overlay   = document.getElementById('confirm-overlay');
    const modal     = document.getElementById('confirm-modal');
    const signoutBtn= document.getElementById('signout-btn');
    const yesBtn    = document.getElementById('yesBtn');
    const noBtn     = document.getElementById('noBtn');

    // Toast
    const toast     = document.getElementById('toast');
    const toastMsg  = document.getElementById('toast-msg');

    // ============================================================
    // MODAL
    // ============================================================
    function openModal() {
      overlay.classList.remove('hidden');
      requestAnimationFrame(() => {
        modal.classList.remove('scale-95', 'opacity-0');
        modal.classList.add('scale-100', 'opacity-100');
      });
    }

    function closeModal() {
      modal.classList.add('scale-95', 'opacity-0');
      modal.classList.remove('scale-100', 'opacity-100');
      setTimeout(() => overlay.classList.add('hidden'), 200);
    }

    signoutBtn.addEventListener('click', openModal);
    noBtn.addEventListener('click', closeModal);
    overlay.addEventListener('click', e => { if (e.target === overlay) closeModal(); });

    // ============================================================
    // TOAST
    // ============================================================
    function showToast(msg, isError = false) {
      toastMsg.textContent = msg;
      toast.classList.toggle('bg-red-600', isError);
      toast.classList.toggle('bg-slate-800', !isError);
      toast.classList.remove('translate-y-16', 'opacity-0');
      toast.classList.add('translate-y-0', 'opacity-100');
      setTimeout(() => {
        toast.classList.add('translate-y-16', 'opacity-0');
        toast.classList.remove('translate-y-0', 'opacity-100');
      }, 3000);
    }

    // ============================================================
    // COUNT / EMPTY
    // ============================================================
    function updateCount() {
      const rows = tableBody.querySelectorAll('tr').length;
      riderCount.textContent = rows;
      emptyState.style.display = rows === 0 ? 'flex' : 'none';
    }

    // ============================================================
    // ADD RIDER TO TABLE
    // ============================================================
    let rowIndex = 0;

    function addRiderToTable({ name, number, date, category }) {
      rowIndex++;
      const row = document.createElement('tr');
      row.className = 'row-in hover:bg-slate-50 transition-colors';

      // Avatar initial helper
      const initials = name.split(' ').map(w => w[0]).join('').slice(0, 2).toUpperCase();
      const colors = ['bg-blue-100 text-blue-600','bg-violet-100 text-violet-600','bg-emerald-100 text-emerald-600','bg-orange-100 text-orange-600','bg-pink-100 text-pink-600'];
      const color = colors[rowIndex % colors.length];

      // Format date
      let displayDate = date;
      try {
        displayDate = new Date(date + 'T00:00:00').toLocaleDateString('en-KE', { day:'2-digit', month:'short', year:'numeric' });
      } catch(e) {}

      row.innerHTML = `
        <td class="px-6 py-4 text-slate-400 text-xs font-mono">${String(rowIndex).padStart(2,'0')}</td>
        <td class="px-6 py-4">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 rounded-full ${color} flex items-center justify-center text-xs font-bold flex-shrink-0">${initials}</div>
            <span class="font-semibold text-slate-700">${name}</span>
          </div>
        </td>
        <td class="px-6 py-4 text-slate-500">${number}</td>
        <td class="px-6 py-4 text-slate-500">${displayDate}</td>
        <td class="px-6 py-4">
          <span class="inline-flex items-center px-2.5 py-1 rounded-lg bg-blue-50 text-blue-700 text-xs font-semibold">${category}</span>
        </td>
        <td class="px-6 py-4">
          <button class="delete-btn flex items-center gap-1.5 text-xs font-medium text-slate-400 hover:text-red-500 bg-slate-100 hover:bg-red-50 px-3 py-1.5 rounded-lg border border-slate-200 hover:border-red-200 transition-all">
            <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
            Remove
          </button>
        </td>
      `;

      // Delete handler
      row.querySelector('.delete-btn').addEventListener('click', () => {
        row.style.transition = 'opacity .25s, transform .25s';
        row.style.opacity = '0';
        row.style.transform = 'translateX(16px)';
        setTimeout(() => {
          row.remove();
          // Remove from localStorage
          let riders = JSON.parse(localStorage.getItem('riders')) || [];
          riders = riders.filter(r => !(r.name === name && r.number === number && r.date === date && r.category === category));
          localStorage.setItem('riders', JSON.stringify(riders));
          updateCount();
          showToast('Rider removed.', true);
        }, 250);
      });

      tableBody.appendChild(row);
      updateCount();
    }

    // ============================================================
    // LOAD FROM LOCALSTORAGE
    // ============================================================
    window.addEventListener('DOMContentLoaded', () => {
      const riders = JSON.parse(localStorage.getItem('riders')) || [];
      riders.forEach(rider => addRiderToTable(rider));
    });

    // ============================================================
    // FORM SUBMIT
    // ============================================================
    form.addEventListener('submit', e => {
      e.preventDefault();

      const name     = nameInput.value.trim();
      const number   = numberInput.value.trim();
      const date     = dateInput.value;
      const category = categoryInput.value;

      if (!name || !number || !date || category === 'select') {
        formError.classList.remove('hidden');
        form.querySelectorAll('input, select').forEach(el => {
          if (!el.value || el.value === 'select') el.classList.add('border-red-300', 'ring-2', 'ring-red-100');
        });
        return;
      }

      formError.classList.add('hidden');
      form.querySelectorAll('input, select').forEach(el => el.classList.remove('border-red-300', 'ring-2', 'ring-red-100'));

      const newRider = { name, number, date, category };

      // Save
      const riders = JSON.parse(localStorage.getItem('riders')) || [];
      riders.push(newRider);
      localStorage.setItem('riders', JSON.stringify(riders));

      addRiderToTable(newRider);
      form.reset();
      showToast(`${name} added to fleet!`);
    });

    // ============================================================
    // SEARCH FILTER
    // ============================================================
    if (searchInput) {
      searchInput.addEventListener('input', () => {
        const q = searchInput.value.toLowerCase();
        tableBody.querySelectorAll('tr').forEach(row => {
          row.style.display = row.textContent.toLowerCase().includes(q) ? '' : 'none';
        });
      });
    }
  </script>
</body>
</html>